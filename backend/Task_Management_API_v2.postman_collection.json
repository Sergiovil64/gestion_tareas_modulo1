{
  "info": {
    "name": "Task Management API v2 - ISO/IEC 27002 Secure",
    "description": "Colección completa de endpoints con controles de seguridad implementados",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000",
      "type": "string"
    },
    {
      "key": "freeToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "premiumToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "adminToken",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "1. Authentication",
      "item": [
        {
          "name": "Register Free User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('freeToken', jsonData.token);",
                  "    console.log('Free user token saved');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Usuario Free\",\n  \"email\": \"free@example.com\",\n  \"password\": \"Password123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "register"]
            },
            "description": "Registra un nuevo usuario con rol FREE (gratuito)"
          }
        },
        {
          "name": "Login Free User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('freeToken', jsonData.token);",
                  "    console.log('Logged in as free user');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"free@example.com\",\n  \"password\": \"Password123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "login"]
            },
            "description": "Inicia sesión con usuario existente"
          }
        },
        {
          "name": "Get Current User (Me)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{freeToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/auth/me",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "me"]
            },
            "description": "Obtiene información del usuario autenticado"
          }
        },
        {
          "name": "Upgrade to Premium",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('premiumToken', jsonData.token);",
                  "    console.log('Upgraded to Premium. New token saved.');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{freeToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/auth/upgrade-to-premium",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "upgrade-to-premium"]
            },
            "description": "Actualiza cuenta de FREE a PREMIUM"
          }
        },
        {
          "name": "Login Admin User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('adminToken', jsonData.token);",
                  "    console.log('Logged in as admin');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@example.com\",\n  \"password\": \"AdminPassword123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "login"]
            },
            "description": "Inicia sesión como administrador"
          }
        }
      ]
    },
    {
      "name": "2. Tasks - Free User",
      "item": [
        {
          "name": "Create Basic Task",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{freeToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Tarea básica de usuario free\",\n  \"description\": \"Sin características premium\",\n  \"dueDate\": \"2025-12-31\",\n  \"priority\": 1\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/tasks",
              "host": ["{{baseUrl}}"],
              "path": ["api", "tasks"]
            },
            "description": "Usuario FREE crea tarea básica (sin color ni imagen)"
          }
        },
        {
          "name": "Try Premium Feature (FAIL)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{freeToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Tarea con color\",\n  \"description\": \"Intentando usar característica premium\",\n  \"dueDate\": \"2025-12-31\",\n  \"color\": \"#FF5733\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/tasks",
              "host": ["{{baseUrl}}"],
              "path": ["api", "tasks"]
            },
            "description": "Debe FALLAR - Usuario FREE intenta usar características premium"
          }
        },
        {
          "name": "Get All Tasks",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{freeToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/tasks",
              "host": ["{{baseUrl}}"],
              "path": ["api", "tasks"]
            },
            "description": "Obtiene todas las tareas del usuario"
          }
        },
        {
          "name": "Get Tasks - Filtered by Status",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{freeToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/tasks?status=PENDIENTE",
              "host": ["{{baseUrl}}"],
              "path": ["api", "tasks"],
              "query": [
                {
                  "key": "status",
                  "value": "PENDIENTE"
                }
              ]
            },
            "description": "Filtra tareas por estado"
          }
        },
        {
          "name": "Get Tasks - Search",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{freeToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/tasks?search=importante",
              "host": ["{{baseUrl}}"],
              "path": ["api", "tasks"],
              "query": [
                {
                  "key": "search",
                  "value": "importante"
                }
              ]
            },
            "description": "Busca tareas por texto en título o descripción"
          }
        },
        {
          "name": "Update Task Status",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{freeToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"EN PROGRESO\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/tasks/1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "tasks", "1"]
            },
            "description": "Actualiza estado de tarea (cambiar ID según necesites)"
          }
        },
        {
          "name": "Delete Task",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{freeToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/tasks/1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "tasks", "1"]
            },
            "description": "Elimina una tarea (cambiar ID según necesites)"
          }
        }
      ]
    },
    {
      "name": "3. Tasks - Premium User",
      "item": [
        {
          "name": "Create Task with Color",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{premiumToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Tarea Premium con Color\",\n  \"description\": \"Esta tarea tiene color personalizado\",\n  \"dueDate\": \"2025-12-31\",\n  \"priority\": 5,\n  \"color\": \"#FF5733\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/tasks",
              "host": ["{{baseUrl}}"],
              "path": ["api", "tasks"]
            },
            "description": "Usuario PREMIUM crea tarea con color personalizado"
          }
        },
        {
          "name": "Create Task with Image",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{premiumToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Tarea Premium con Imagen\",\n  \"description\": \"Esta tarea tiene una imagen\",\n  \"dueDate\": \"2025-12-31\",\n  \"priority\": 4,\n  \"imageUrl\": \"https://picsum.photos/200/300\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/tasks",
              "host": ["{{baseUrl}}"],
              "path": ["api", "tasks"]
            },
            "description": "Usuario PREMIUM crea tarea con imagen"
          }
        },
        {
          "name": "Create Premium Task Full",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{premiumToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Tarea Premium Completa\",\n  \"description\": \"Con todas las características premium\",\n  \"dueDate\": \"2025-12-31\",\n  \"priority\": 5,\n  \"color\": \"#4CAF50\",\n  \"imageUrl\": \"https://picsum.photos/400/300\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/tasks",
              "host": ["{{baseUrl}}"],
              "path": ["api", "tasks"]
            },
            "description": "Usuario PREMIUM crea tarea con color E imagen"
          }
        },
        {
          "name": "Update Task with Premium Features",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{premiumToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"color\": \"#2196F3\",\n  \"imageUrl\": \"https://picsum.photos/500/350\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/tasks/1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "tasks", "1"]
            },
            "description": "Usuario PREMIUM actualiza características premium de tarea"
          }
        }
      ]
    },
    {
      "name": "4. Admin - User Management",
      "item": [
        {
          "name": "Get All Users",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/admin/users",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users"]
            },
            "description": "Admin obtiene lista de todos los usuarios"
          }
        },
        {
          "name": "Get System Statistics",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/admin/stats",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "stats"]
            },
            "description": "Admin obtiene estadísticas del sistema"
          }
        },
        {
          "name": "Change User Role to Premium",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"role\": \"PREMIUM\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/admin/users/2/role",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users", "2", "role"]
            },
            "description": "Admin cambia rol de usuario a PREMIUM"
          }
        },
        {
          "name": "Change User Role to Admin",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"role\": \"ADMIN\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/admin/users/3/role",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users", "3", "role"]
            },
            "description": "Admin cambia rol de usuario a ADMIN"
          }
        },
        {
          "name": "Deactivate User",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/admin/users/2/toggle-status",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users", "2", "toggle-status"]
            },
            "description": "Admin activa/desactiva cuenta de usuario"
          }
        }
      ]
    },
    {
      "name": "5. Rate Limiting Tests",
      "item": [
        {
          "name": "Test Login Rate Limit",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@example.com\",\n  \"password\": \"WrongPassword123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "login"]
            },
            "description": "Ejecuta este request 6+ veces rápidamente para activar rate limiting"
          }
        },
        {
          "name": "Test Registration Rate Limit",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Test User\",\n  \"email\": \"test{{$randomInt}}@example.com\",\n  \"password\": \"Password123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "register"]
            },
            "description": "Ejecuta 4+ veces en una hora para activar rate limiting"
          }
        }
      ]
    },
    {
      "name": "6. Security Tests",
      "item": [
        {
          "name": "Access Without Token (FAIL)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/tasks",
              "host": ["{{baseUrl}}"],
              "path": ["api", "tasks"]
            },
            "description": "Debe FALLAR - Intenta acceder sin token"
          }
        },
        {
          "name": "Invalid Token (FAIL)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer invalid_token_here"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/tasks",
              "host": ["{{baseUrl}}"],
              "path": ["api", "tasks"]
            },
            "description": "Debe FALLAR - Intenta usar token inválido"
          }
        },
        {
          "name": "Free User Access Admin (FAIL)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{freeToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/admin/users",
              "host": ["{{baseUrl}}"],
              "path": ["api", "admin", "users"]
            },
            "description": "Debe FALLAR - Usuario FREE intenta acceder a endpoint de admin"
          }
        },
        {
          "name": "XSS Attack Test (Protected)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{freeToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"<script>alert('XSS')</script>\",\n  \"description\": \"<img src=x onerror='alert(1)'>\",\n  \"dueDate\": \"2025-12-31\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/tasks",
              "host": ["{{baseUrl}}"],
              "path": ["api", "tasks"]
            },
            "description": "Los caracteres especiales deben ser escapados"
          }
        }
      ]
    }
  ]
}

